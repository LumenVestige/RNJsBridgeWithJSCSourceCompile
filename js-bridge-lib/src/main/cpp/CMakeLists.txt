# Copyright (c) Facebook, Inc. and its affiliates.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

cmake_minimum_required(VERSION 3.6.0)
project(jsbridge LANGUAGES C CXX)


#-Wall:
#å¯ç”¨æ‰€æœ‰å¸¸è§„çš„è­¦å‘Šæ¶ˆæ¯ã€‚è¿™æœ‰åŠ©äºå‘ç°æ½œåœ¨çš„ä»£ç é—®é¢˜ã€‚
#-std=c++14:
#æŒ‡å®š C++ æ ‡å‡†ä¸º C++14ã€‚ç¡®ä¿ç¼–è¯‘å™¨ä½¿ç”¨ C++14 æ ‡å‡†è¿›è¡Œç¼–è¯‘ã€‚
#-pthread:
#å¯ç”¨å¤šçº¿ç¨‹æ”¯æŒï¼Œå¹¶é“¾æ¥ pthread åº“ã€‚è¿™å¯¹äºä½¿ç”¨çº¿ç¨‹çš„ç¨‹åºæ˜¯å¿…éœ€çš„ã€‚
#-fno-omit-frame-pointer:
#ä¸çœç•¥å¸§æŒ‡é’ˆã€‚è¿™å¯¹è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·ï¼ˆå¦‚ gdb å’Œ perfï¼‰æœ‰å¸®åŠ©ã€‚
#-fexceptions:
#å¯ç”¨ C++ å¼‚å¸¸å¤„ç†æ”¯æŒã€‚å…è®¸åœ¨ä»£ç ä¸­ä½¿ç”¨ try, catch, throwã€‚
#-frtti:
#å¯ç”¨è¿è¡Œæ—¶ç±»å‹è¯†åˆ« (RTTI)ã€‚å…è®¸ä½¿ç”¨ C++ çš„ typeid å’Œ dynamic_cast æ“ä½œç¬¦ã€‚
#-ffunction-sections:
#å°†æ¯ä¸ªå‡½æ•°æˆ–æ•°æ®é¡¹æ”¾å…¥å•ç‹¬çš„æ®µä¸­ã€‚è¿™å¯ä»¥åœ¨é“¾æ¥æ—¶å®ç°æ›´å¥½çš„ä¼˜åŒ–å’Œè£å‰ªæœªä½¿ç”¨çš„ä»£ç ã€‚
#-O3:
#å¯ç”¨æœ€é«˜çº§åˆ«çš„ä¼˜åŒ–é€‰é¡¹ã€‚è¿™ä¼šç”Ÿæˆæ›´å¿«çš„ä»£ç ï¼Œä½†å¯èƒ½ä¼šä½¿ç¼–è¯‘æ—¶é—´æ›´é•¿ã€‚
#-DNDEBUG:
#å®šä¹‰ NDEBUG å®ï¼Œé€šå¸¸ç”¨äºç¦ç”¨è°ƒè¯•ç›¸å…³çš„æ–­è¨€ (assert)ã€‚
set(FOLLY_FLAGS "-DFOLLY_NO_CONFIG -DFOLLY_HAVE_CLOCK_GETTIME -DFOLLY_HAVE_MEMRCHR -DFOLLY_USE_LIBCPP -DFOLLY_NO_CONFIG=1 -DFOLLY_HAVE_XSI_STRERROR_R=1 -DENABLE_FBASSERT")

# ä¸º C++ ç¼–è¯‘å™¨æ·»åŠ  -v æ ‡å¿—
set(CMAKE_CXX_FLAGS "${FOLLY_FLAGS} -g")
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -g")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g")
set(CMAKE_STRIP "")


set(CMAKE_BUILD_TYPE Debug)
set(CMAKE_VERBOSE_MAKEFILE ON)


add_compile_options(
        -w # å…³é—­æ‰€æœ‰è­¦å‘Š
        -Wall
        -pthread
        -fno-omit-frame-pointer
        -fexceptions
        -frtti
        -ffunction-sections
        -O0 # just for debug
)

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
message("ğŸ’¡ CMAKE_CXX_STANDARD = ${CMAKE_CXX_STANDARD}")

include_directories(icu/include)
include_directories(glog/glog/exported)
include_directories(fbgloginit)
include_directories(folly)
include_directories(boost/boost_1_63_0)
include_directories(jscexecutor)
include_directories(bridge/include)
include_directories(jsc/webkit/Source/JavaScriptCore/API)
include_directories(double_conversion)
include_directories(trace)

add_subdirectory(trace)
add_subdirectory(icu)
add_subdirectory(jsc)
add_subdirectory(cxxmodule)
add_subdirectory(jscexecutor)
add_subdirectory(boost)
add_subdirectory(folly)
add_subdirectory(fbgloginit)
add_subdirectory(glog/glog)
add_subdirectory(bridge)
add_subdirectory(fbjni)
add_subdirectory(double_conversion/double_conversion)